#!/usr/bin/env bash
# Changes the port configuration in Nginx from 8080 to 80 and restarts the Nginx service

# Update package list and install Nginx if not installed
sudo apt-get update
sudo apt-get install -y nginx

# Update Nginx configuration to change port 8080 to 80
if grep -q '8080' /etc/nginx/sites-available/default; then
  sudo sed -i 's/8080/80/g' /etc/nginx/sites-available/default
  sudo sed -i 's/8080/80/g' /etc/nginx/sites-enabled/default
fi

# Restart Nginx service to apply changes
sudo service nginx restart

# Enable Nginx to start on boot
sudo systemctl enable nginx

# Check if Nginx is running and listening on port 80
for i in {1..5}; do
  status_code=$(curl -o /dev/null -s -w "%{http_code}\n" http://localhost)
  if [ "$status_code" -eq 200 ]; then
    echo "Nginx is running and serving HTTP 200 on port 80"
    exit 0
  else
    echo "Attempt $i: Nginx is not serving HTTP 200 on port 80. Status code: $status_code"
    sleep 2
  fi
done

echo "Nginx did not start correctly on port 80. Exiting."
exit 1

